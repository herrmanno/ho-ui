var __extends=this&&this.__extends||function(t,r){function e(){this.constructor=t}for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);e.prototype=r.prototype,t.prototype=new e},Promise=ho.promise.Promise,Router=function(t){function r(){t.call(this),this.mapping=null,this.actions=["RouterActions"],window.onhashchange=this.onHashChange.bind(this)}return __extends(r,t),r.prototype.init=function(){var r=this;return t.prototype.init.call(this).then(function(){r.onHashChange()})},r.prototype.onStateChangeRequested=function(t){var r=this.getStateFromName(t.state),e=this.urlFromState(r.url,t.args);if(!(this.data&&this.data.state&&this.data.state.name===t.state&&this.equals(this.data.args,t.args)&&e===window.location.hash.substr(1))){r.redirect&&(r=this.getStateFromName(r.redirect));var o="function"==typeof r.before?r.before(t):Promise.create(void 0);o.then(function(){var e=!!t.extern;this.data={state:r,args:t.args,extern:e};var o=this.urlFromState(r.url,t.args);this.setUrl(o),this.changed()}.bind(this),function(t){this.onStateChangeRequested(t)}.bind(this))}},r.prototype.onHashChange=function(){var t=this.stateFromUrl(window.location.hash.substr(1)),r={state:t.state,args:t.args,extern:!0};ho.flux.ACTIONS.get(RouterActions).go(r)},r.prototype.setUrl=function(t){if(window.location.hash.substr(1)!==t){var r=window.onhashchange;window.onhashchange=null,window.location.hash=t,window.onhashchange=r}},r.prototype.getStateFromName=function(t){return this.mapping.filter(function(r){return r.name===t})[0]},r.prototype.regexFromUrl=function(t){for(var r=/:([\w]+)/;t.match(r);)t=t.replace(r,"([^/]+)");return t+"$"},r.prototype.argsFromUrl=function(t,r){var e=this.regexFromUrl(t),o=t.match(e).slice(1),n=r.match(e).slice(1),a={};return o.forEach(function(t,r){a[t.substr(1)]=n[r]}),a},r.prototype.stateFromUrl=function(t){var r=this,e=void 0;if(this.mapping.forEach(function(o){if(!e){var n=r.regexFromUrl(o.url);if(t.match(n)){var a=r.argsFromUrl(o.url,t);e={state:o.name,args:a,extern:!1}}}}),!e)throw"No State found for url "+t;return e},r.prototype.urlFromState=function(t,r){for(var e=/:([\w]+)/;t.match(e);)t=t.replace(e,function(t){return r[t.substr(1)]});return t},r.prototype.equals=function(t,r){return JSON.stringify(t)===JSON.stringify(r)},r}(ho.flux.Store);