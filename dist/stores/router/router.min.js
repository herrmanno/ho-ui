var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);r.prototype=e.prototype,t.prototype=new r},__decorate=this&&this.__decorate||function(t,e,r,o){if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)return Reflect.decorate(t,e,r,o);switch(arguments.length){case 2:return t.reduceRight(function(t,e){return e&&e(t)||t},e);case 3:return t.reduceRight(function(t,o){return void(o&&o(e,r))},void 0);case 4:return t.reduceRight(function(t,o){return o&&o(e,r,t)||t},o)}},Promise=ho.promise.Promise,Router=function(t){function e(){t.call(this),this.mapping=null,this.actions=["RouterActions"],window.onhashchange=this.onHashChange.bind(this)}return __extends(e,t),e.prototype.init=function(){var e=this;return t.prototype.init.call(this).then(function(){e.onHashChange()})},e.prototype.onStateChangeRequested=function(t){var e=this.getStateFromName(t.state),r=this.urlFromState(e.url,t.args);if(!(this.data&&this.data.state&&this.data.state.name===t.state&&this.equals(this.data.args,t.args)&&r===window.location.hash.substr(1))){e.redirect&&(e=this.getStateFromName(e.redirect));var o="function"==typeof e.before?e.before(t):Promise.create(void 0);o.then(function(){var r=!!t.extern;this.data={state:e,args:t.args,extern:r};var o=this.urlFromState(e.url,t.args);this.setUrl(o),this.changed()}.bind(this),function(t){this.onStateChangeRequested(t)}.bind(this))}},e.prototype.onHashChange=function(){var t=this.stateFromUrl(window.location.hash.substr(1)),e={state:t.state,args:t.args,extern:!0};ho.flux.ACTIONS.get(RouterActions).go(e)},e.prototype.setUrl=function(t){if(window.location.hash.substr(1)!==t){var e=window.onhashchange;window.onhashchange=null,window.location.hash=t,window.onhashchange=e}},e.prototype.getStateFromName=function(t){return this.mapping.filter(function(e){return e.name===t})[0]},e.prototype.regexFromUrl=function(t){for(var e=/:([\w]+)/;t.match(e);)t=t.replace(e,"([^/]+)");return t+"$"},e.prototype.argsFromUrl=function(t,e){var r=this.regexFromUrl(t),o=t.match(r).slice(1),n=e.match(r).slice(1),a={};return o.forEach(function(t,e){a[t.substr(1)]=n[e]}),a},e.prototype.stateFromUrl=function(t){var e=this,r=void 0;if(this.mapping.forEach(function(o){if(!r){var n=e.regexFromUrl(o.url);if(t.match(n)){var a=e.argsFromUrl(o.url,t);r={state:o.name,args:a,extern:!1}}}}),!r)throw"No State found for url "+t;return r},e.prototype.urlFromState=function(t,e){for(var r=/:([\w]+)/;t.match(r);)t=t.replace(r,function(t){return e[t.substr(1)]});return t},e.prototype.equals=function(t,e){return JSON.stringify(t)===JSON.stringify(e)},Object.defineProperty(e.prototype,"onStateChangeRequested",__decorate([ho.flux.Store.on("STATE")],e.prototype,"onStateChangeRequested",Object.getOwnPropertyDescriptor(e.prototype,"onStateChangeRequested"))),e}(ho.flux.Store);