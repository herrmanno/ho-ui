var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);n.prototype=e.prototype,t.prototype=new n},View=function(t){function e(){t.apply(this,arguments),this.html="",this.properties=[{name:"viewname",required:!0}]}return __extends(e,t),e.prototype.init=function(){ho.flux.STORES.get(ho.flux.Router).register(this.state_changed,this)},Object.defineProperty(e.prototype,"viewname",{get:function(){return this.properties.viewname},enumerable:!0,configurable:!0}),e.prototype.state_changed=function(t){var e=this.getState(t);e.component?this.renderComponent(e.component):this.renderHTML(e.html)},e.prototype.renderComponent=function(t){var e=ho.components.registry.instance;e.loadComponent(t).then(function(){this.html=!1,this.element.innerHTML="<"+t+" />",this.render()}.bind(this))},e.prototype.renderHTML=function(t){this.getHtml(t).then(function(e){return t=e,this.loadDynamicRequirements(t)}.bind(this)).then(function(){this.html=!1,this.element.innerHTML=t,this.render()}.bind(this))},e.prototype.getState=function(t){var e=this,n=t.state.view.filter(function(t){return t.name===e.viewname})[0];return n},e.prototype.getHtml=function(t){return"undefined"==typeof t?ho.promise.Promise.create(null):".html"!==t.slice(-5)?ho.promise.Promise.create(t):new ho.promise.Promise(function(e,n){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState){var t=o.responseText;200==o.status?e(t):n(t)}},o.open("GET",t,!0),o.send()})},e.prototype.loadDynamicRequirements=function(t){return ho.promise.Promise.all([this.loadDynamicComponents(t),this.loadDynamicAttributes(t)])},e.prototype.loadDynamicComponents=function(t){var e=t.match(/<!--\s*requires?="(.+)"/);e=null!==e?e[1].split(",").map(function(t){return t.trim()}):[];var n=ho.components.registry.instance,o=e.filter(function(t){return!n.hasComponent(t)}).map(function(t){return n.loadComponent(t)});return ho.promise.Promise.all(o)},e.prototype.loadDynamicAttributes=function(t){var e=t.match(/<!--\s*attributes?="(.+)"/);e=null!==e?e[1].split(",").map(function(t){return t.trim()}):[];var n=ho.components.registry.instance,o=e.filter(function(t){return!n.hasAttribute(t)}).map(function(t){return n.loadAttribute(t)});return ho.promise.Promise.all(o)},e}(ho.components.Component);