var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},View=function(t){function e(){t.apply(this,arguments),this.html="",this.properties=[{name:"viewname",required:!0}]}return __extends(e,t),e.prototype.init=function(){ho.flux.STORES.get(ho.flux.Router).register(this.state_changed,this)},Object.defineProperty(e.prototype,"viewname",{get:function(){return this.properties.viewname},enumerable:!0,configurable:!0}),e.prototype.state_changed=function(t){var e=this,n=null;try{n=t.state.view.filter(function(t){return t.name===e.viewname})[0].html}catch(r){n=null}this.getHtml(n).then(function(t){return n=t,this.loadDynamicRequirements(n)}.bind(this)).then(function(){this.html=!1,this.element.innerHTML=n,this.render()}.bind(this))},e.prototype.getHtml=function(t){return"undefined"==typeof t?ho.promise.Promise.create(null):".html"!==t.slice(-5)?ho.promise.Promise.create(t):new ho.promise.Promise(function(e,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState){var t=r.responseText;200==r.status?e(t):n(t)}},r.open("GET",t,!0),r.send()})},e.prototype.loadDynamicRequirements=function(t){return ho.promise.Promise.all([this.loadDynamicComponents(t),this.loadDynamicAttributes(t)])},e.prototype.loadDynamicComponents=function(t){var e=t.match(/<!--\s*requires?="(.+)"/);e=null!==e?e[1].split(",").map(function(t){return t.trim()}):[];var n=ho.components.registry.instance,r=e.filter(function(t){return!n.hasComponent(t)}).map(function(t){return n.loadComponent(t)});return ho.promise.Promise.all(r)},e.prototype.loadDynamicAttributes=function(t){var e=t.match(/<!--\s*attributes?="(.+)"/);e=null!==e?e[1].split(",").map(function(t){return t.trim()}):[];var n=ho.components.registry.instance,r=e.filter(function(t){return!n.hasAttribute(t)}).map(function(t){return n.loadAttribute(t)});return ho.promise.Promise.all(r)},e}(ho.components.Component);