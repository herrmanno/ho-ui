/// <reference path="../../../../bower_components/ho-promise/dist/promise.d.ts"/>
/// <reference path="../../../../bower_components/ho-components/dist/components.d.ts"/>
/// <reference path="../../../../bower_components/ho-flux/dist/flux.d.ts"/>
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var View = (function (_super) {
    __extends(View, _super);
    function View() {
        _super.apply(this, arguments);
        this.html = "";
        this.properties = [
            { name: 'viewname', required: true }
        ];
    }
    View.prototype.init = function () {
        ho.flux.STORES.get(ho.flux.Router).register(this.state_changed, this);
    };
    Object.defineProperty(View.prototype, "viewname", {
        get: function () {
            return this.properties['viewname'];
        },
        enumerable: true,
        configurable: true
    });
    View.prototype.state_changed = function (data) {
        var _this = this;
        var html = null;
        try {
            html = data.state.view.filter(function (v) {
                return v.name === _this.viewname;
            })[0].html;
        }
        catch (e) {
            html = null;
        }
        this.getHtml(html)
            .then(function (h) {
            html = h;
            return this.loadDynamicRequirements(html);
        }.bind(this))
            .then(function () {
            this.html = false;
            this.element.innerHTML = html;
            this.render();
        }.bind(this));
    };
    View.prototype.getHtml = function (html) {
        if (typeof html === 'undefined')
            return ho.promise.Promise.create(null);
        else if (html.slice(-5) !== '.html')
            return ho.promise.Promise.create(html);
        else
            return new ho.promise.Promise(function (resolve, reject) {
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function () {
                    if (xmlhttp.readyState == 4) {
                        var resp = xmlhttp.responseText;
                        if (xmlhttp.status == 200) {
                            resolve(resp);
                        }
                        else {
                            reject(resp);
                        }
                    }
                };
                xmlhttp.open('GET', html, true);
                xmlhttp.send();
            });
    };
    View.prototype.loadDynamicRequirements = function (html) {
        return ho.promise.Promise.all([this.loadDynamicComponents(html), this.loadDynamicAttributes(html)]);
    };
    View.prototype.loadDynamicComponents = function (html) {
        var requirements = html.match(/<!--\s*requires?="(.+)"/);
        if (requirements !== null)
            requirements = requirements[1].split(",").map(function (r) { return r.trim(); });
        else
            requirements = [];
        var Registry = ho.components.registry.instance;
        var promises = requirements
            .filter(function (req) {
            return !Registry.hasComponent(req);
        })
            .map(function (req) {
            return Registry.loadComponent(req);
        });
        return ho.promise.Promise.all(promises);
    };
    View.prototype.loadDynamicAttributes = function (html) {
        var attributes = html.match(/<!--\s*attributes?="(.+)"/);
        if (attributes !== null)
            attributes = attributes[1].split(",").map(function (a) { return a.trim(); });
        else
            attributes = [];
        var Registry = ho.components.registry.instance;
        var promises = attributes
            .filter(function (attr) {
            return !Registry.hasAttribute(attr);
        })
            .map(function (attr) {
            return Registry.loadAttribute(attr);
        });
        return ho.promise.Promise.all(promises);
    };
    return View;
})(ho.components.Component);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvVmlldy92aWV3LnRzIl0sIm5hbWVzIjpbIlZpZXciLCJWaWV3LmNvbnN0cnVjdG9yIiwiVmlldy5pbml0IiwiVmlldy52aWV3bmFtZSIsIlZpZXcuc3RhdGVfY2hhbmdlZCIsIlZpZXcuZ2V0SHRtbCIsIlZpZXcubG9hZER5bmFtaWNSZXF1aXJlbWVudHMiLCJWaWV3LmxvYWREeW5hbWljQ29tcG9uZW50cyIsIlZpZXcubG9hZER5bmFtaWNBdHRyaWJ1dGVzIl0sIm1hcHBpbmdzIjoiQUFBQSxpRkFBaUY7QUFDakYsdUZBQXVGO0FBQ3ZGLDJFQUEyRTs7Ozs7OztBQUUzRTtJQUFtQkEsd0JBQXVCQTtJQUExQ0E7UUFBbUJDLDhCQUF1QkE7UUFFekNBLFNBQUlBLEdBQUdBLEVBQUVBLENBQUNBO1FBRVZBLGVBQVVBLEdBQUdBO1lBQ1pBLEVBQUVBLElBQUlBLEVBQUVBLFVBQVVBLEVBQUVBLFFBQVFBLEVBQUVBLElBQUlBLEVBQUVBO1NBQ3BDQSxDQUFDQTtJQW9HSEEsQ0FBQ0E7SUFsR0FELG1CQUFJQSxHQUFKQTtRQUNDRSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtJQUN2RUEsQ0FBQ0E7SUFFREYsc0JBQUlBLDBCQUFRQTthQUFaQTtZQUNDRyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtRQUNwQ0EsQ0FBQ0E7OztPQUFBSDtJQUVTQSw0QkFBYUEsR0FBdkJBLFVBQXdCQSxJQUF5QkE7UUFBakRJLGlCQW9CQ0E7UUFuQkdBLElBQUlBLElBQUlBLEdBQVdBLElBQUlBLENBQUNBO1FBQzNCQSxJQUFJQSxDQUFDQTtZQUNKQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxL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IDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uLy4uLy4uL2Jvd2VyX2NvbXBvbmVudHMvaG8tcHJvbWlzZS9kaXN0L3Byb21pc2UuZC50c1wiLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uLy4uLy4uL2Jvd2VyX2NvbXBvbmVudHMvaG8tY29tcG9uZW50cy9kaXN0L2NvbXBvbmVudHMuZC50c1wiLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uLy4uLy4uL2Jvd2VyX2NvbXBvbmVudHMvaG8tZmx1eC9kaXN0L2ZsdXguZC50c1wiLz5cclxuXHJcbmNsYXNzIFZpZXcgZXh0ZW5kcyBoby5jb21wb25lbnRzLkNvbXBvbmVudCB7XHJcblxyXG5cdGh0bWwgPSBcIlwiO1xyXG5cclxuXHRwcm9wZXJ0aWVzID0gW1xyXG5cdFx0eyBuYW1lOiAndmlld25hbWUnLCByZXF1aXJlZDogdHJ1ZSB9XHJcblx0XTtcclxuXHJcblx0aW5pdCgpIHtcclxuXHRcdGhvLmZsdXguU1RPUkVTLmdldChoby5mbHV4LlJvdXRlcikucmVnaXN0ZXIodGhpcy5zdGF0ZV9jaGFuZ2VkLCB0aGlzKTtcclxuXHR9XHJcblxyXG5cdGdldCB2aWV3bmFtZSgpIHtcclxuXHRcdHJldHVybiB0aGlzLnByb3BlcnRpZXNbJ3ZpZXduYW1lJ107XHJcblx0fVxyXG5cclxuXHRwcm90ZWN0ZWQgc3RhdGVfY2hhbmdlZChkYXRhOiBoby5mbHV4LklSb3V0ZXJEYXRhKTogdm9pZCB7XHJcblx0ICAgIGxldCBodG1sOiBzdHJpbmcgPSBudWxsO1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0aHRtbCA9IGRhdGEuc3RhdGUudmlldy5maWx0ZXIoKHYpID0+IHtcclxuXHQgICAgICBcdFx0cmV0dXJuIHYubmFtZSA9PT0gdGhpcy52aWV3bmFtZTtcclxuXHRcdCAgICB9KVswXS5odG1sO1xyXG5cdFx0fSBjYXRjaChlKSB7XHJcblx0XHRcdGh0bWwgPSBudWxsO1xyXG5cdFx0fVxyXG5cclxuXHQgICAgdGhpcy5nZXRIdG1sKGh0bWwpXHJcbiAgXHRcdC50aGVuKGZ1bmN0aW9uKGgpIHtcclxuXHQgICAgICBcdGh0bWwgPSBoO1xyXG5cdCAgICAgIFx0cmV0dXJuIHRoaXMubG9hZER5bmFtaWNSZXF1aXJlbWVudHMoaHRtbCk7XHJcblx0ICAgIH0uYmluZCh0aGlzKSlcclxuICAgICAgXHQudGhlbihmdW5jdGlvbigpIHtcclxuXHQgICAgICBcdHRoaXMuaHRtbCA9IGZhbHNlO1xyXG5cdCAgICAgIFx0dGhpcy5lbGVtZW50LmlubmVySFRNTCA9IGh0bWw7XHJcblx0ICAgICAgXHR0aGlzLnJlbmRlcigpO1xyXG5cdCAgICB9LmJpbmQodGhpcykpO1xyXG5cdH1cclxuXHJcblx0XHRwcm90ZWN0ZWQgZ2V0SHRtbChodG1sOiBzdHJpbmcpOiBoby5wcm9taXNlLlByb21pc2U8c3RyaW5nLCBzdHJpbmc+IHtcclxuXHRcdGlmICh0eXBlb2YgaHRtbCA9PT0gJ3VuZGVmaW5lZCcpXHJcblx0ICAgICAgXHRyZXR1cm4gaG8ucHJvbWlzZS5Qcm9taXNlLmNyZWF0ZShudWxsKTtcclxuXHQgICAgZWxzZSBpZiAoaHRtbC5zbGljZSgtNSkgIT09ICcuaHRtbCcpXHJcblx0ICAgICAgXHRyZXR1cm4gaG8ucHJvbWlzZS5Qcm9taXNlLmNyZWF0ZShodG1sKTtcclxuXHQgICAgZWxzZSByZXR1cm4gbmV3IGhvLnByb21pc2UuUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG5cdCAgICAgIFx0bGV0IHhtbGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuXHQgICAgICBcdHhtbGh0dHAub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XHJcblx0ICAgICAgICBcdGlmICh4bWxodHRwLnJlYWR5U3RhdGUgPT0gNCkge1xyXG5cdFx0ICAgICAgICAgIFx0dmFyIHJlc3AgPSB4bWxodHRwLnJlc3BvbnNlVGV4dDtcclxuXHRcdCAgICAgICAgICBcdGlmICh4bWxodHRwLnN0YXR1cyA9PSAyMDApIHtcclxuXHRcdCAgICAgICAgICAgIFx0cmVzb2x2ZShyZXNwKTtcclxuXHRcdCAgICAgICAgICBcdH0gZWxzZSB7XHJcblx0XHQgICAgICAgICAgICBcdHJlamVjdChyZXNwKTtcclxuXHRcdCAgICAgICAgICBcdH1cclxuXHQgICAgICAgIFx0fVxyXG5cdCAgICAgIFx0fTtcclxuXHJcblx0ICAgICAgXHR4bWxodHRwLm9wZW4oJ0dFVCcsIGh0bWwsIHRydWUpO1xyXG5cdCAgICAgIFx0eG1saHR0cC5zZW5kKCk7XHJcblxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRwcm90ZWN0ZWQgbG9hZER5bmFtaWNSZXF1aXJlbWVudHMoaHRtbDogc3RyaW5nKTogaG8ucHJvbWlzZS5Qcm9taXNlPGFueSwgYW55PiB7XHJcblx0XHRyZXR1cm4gaG8ucHJvbWlzZS5Qcm9taXNlLmFsbChbdGhpcy5sb2FkRHluYW1pY0NvbXBvbmVudHMoaHRtbCksIHRoaXMubG9hZER5bmFtaWNBdHRyaWJ1dGVzKGh0bWwpXSk7XHJcblx0fVxyXG5cclxuXHRwcm90ZWN0ZWQgbG9hZER5bmFtaWNDb21wb25lbnRzKGh0bWw6IHN0cmluZyk6IGhvLnByb21pc2UuUHJvbWlzZTxzdHJpbmcsIHN0cmluZz4ge1xyXG5cdCAgICBsZXQgcmVxdWlyZW1lbnRzID0gaHRtbC5tYXRjaCgvPCEtLVxccypyZXF1aXJlcz89XCIoLispXCIvKTtcclxuXHQgICAgaWYgKHJlcXVpcmVtZW50cyAhPT0gbnVsbClcclxuXHQgICAgICBcdHJlcXVpcmVtZW50cyA9IHJlcXVpcmVtZW50c1sxXS5zcGxpdChcIixcIikubWFwKChyKSA9PiB7IHJldHVybiByLnRyaW0oKSB9KTtcclxuXHQgICAgZWxzZVxyXG5cdCAgICAgIFx0cmVxdWlyZW1lbnRzID0gW107XHJcblxyXG5cdCAgICBsZXQgUmVnaXN0cnkgPSBoby5jb21wb25lbnRzLnJlZ2lzdHJ5Lmluc3RhbmNlO1xyXG5cclxuXHQgICAgbGV0IHByb21pc2VzID0gcmVxdWlyZW1lbnRzXHJcbiAgICAgIFx0LmZpbHRlcigocmVxKSA9PiB7XHJcblx0ICAgICAgXHRyZXR1cm4gIVJlZ2lzdHJ5Lmhhc0NvbXBvbmVudChyZXEpO1xyXG5cdCAgICB9KVxyXG5cdCAgICAubWFwKChyZXEpID0+IHtcclxuXHQgICAgXHRyZXR1cm4gUmVnaXN0cnkubG9hZENvbXBvbmVudChyZXEpO1xyXG5cdCAgICB9KTtcclxuXHJcblx0ICAgIHJldHVybiBoby5wcm9taXNlLlByb21pc2UuYWxsKHByb21pc2VzKTtcclxuXHR9XHJcblxyXG5cdHByb3RlY3RlZCBsb2FkRHluYW1pY0F0dHJpYnV0ZXMoaHRtbDogc3RyaW5nKTogaG8ucHJvbWlzZS5Qcm9taXNlPHN0cmluZywgc3RyaW5nPiB7XHJcblx0ICAgIGxldCBhdHRyaWJ1dGVzID0gaHRtbC5tYXRjaCgvPCEtLVxccyphdHRyaWJ1dGVzPz1cIiguKylcIi8pO1xyXG5cdCAgICBpZiAoYXR0cmlidXRlcyAhPT0gbnVsbClcclxuXHQgICAgICBcdGF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzWzFdLnNwbGl0KFwiLFwiKS5tYXAoKGEpID0+IHsgcmV0dXJuIGEudHJpbSgpIH0pO1xyXG5cdCAgICBlbHNlXHJcblx0ICAgICAgXHRhdHRyaWJ1dGVzID0gW107XHJcblxyXG5cdCAgICBsZXQgUmVnaXN0cnkgPSBoby5jb21wb25lbnRzLnJlZ2lzdHJ5Lmluc3RhbmNlO1xyXG5cclxuXHQgICAgbGV0IHByb21pc2VzID0gYXR0cmlidXRlc1xyXG4gICAgICBcdC5maWx0ZXIoKGF0dHIpID0+IHtcclxuXHQgICAgICBcdHJldHVybiAhUmVnaXN0cnkuaGFzQXR0cmlidXRlKGF0dHIpO1xyXG5cdCAgICB9KVxyXG5cdCAgICAubWFwKChhdHRyKSA9PiB7XHJcblx0ICAgIFx0cmV0dXJuIFJlZ2lzdHJ5LmxvYWRBdHRyaWJ1dGUoYXR0cik7XHJcblx0ICAgIH0pO1xyXG5cclxuXHQgICAgcmV0dXJuIGhvLnByb21pc2UuUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xyXG5cdH1cclxufVxyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=