/// <reference path="../../../../bower_components/ho-promise/dist/promise.d.ts"/>
/// <reference path="../../../../bower_components/ho-components/dist/components.d.ts"/>
/// <reference path="../../../../bower_components/ho-flux/dist/flux.d.ts"/>
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var View = (function (_super) {
    __extends(View, _super);
    function View() {
        _super.apply(this, arguments);
        this.html = "";
        this.properties = [
            { name: 'viewname', required: true }
        ];
    }
    View.prototype.init = function () {
        ho.flux.STORES.get(ho.flux.Router).register(this.state_changed, this);
    };
    Object.defineProperty(View.prototype, "viewname", {
        get: function () {
            return this.properties['viewname'];
        },
        enumerable: true,
        configurable: true
    });
    View.prototype.state_changed = function (data) {
        var _this = this;
        var html = null;
        try {
            html = data.state.view.filter(function (v) {
                return v.name === _this.viewname;
            })[0].html;
        }
        catch (e) {
            html = null;
        }
        this.getHtml(html)
            .then(function (h) {
            html = h;
            return this.loadDynamicRequirements(html);
        }.bind(this))
            .then(function () {
            this.html = false;
            this.element.innerHTML = html;
            this.render();
        }.bind(this));
    };
    View.prototype.getHtml = function (html) {
        if (typeof html === 'undefined')
            return ho.promise.Promise.create(null);
        else if (html.slice(-5) !== '.html')
            return ho.promise.Promise.create(html);
        else
            return new ho.promise.Promise(function (resolve, reject) {
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function () {
                    if (xmlhttp.readyState == 4) {
                        var resp = xmlhttp.responseText;
                        if (xmlhttp.status == 200) {
                            resolve(resp);
                        }
                        else {
                            reject(resp);
                        }
                    }
                };
                xmlhttp.open('GET', html, true);
                xmlhttp.send();
            });
    };
    View.prototype.loadDynamicRequirements = function (html) {
        return ho.promise.Promise.all([this.loadDynamicComponents(html), this.loadDynamicAttributes(html)]);
    };
    View.prototype.loadDynamicComponents = function (html) {
        var requirements = html.match(/<!--\s*requires?="(.+)"/);
        if (requirements !== null)
            requirements = requirements[1].split(",").map(function (r) { return r.trim(); });
        else
            requirements = [];
        var Registry = ho.components.registry.instance;
        var promises = requirements
            .filter(function (req) {
            return !Registry.hasComponent(req);
        })
            .map(function (req) {
            return Registry.loadComponent(req);
        });
        return ho.promise.Promise.all(promises);
    };
    View.prototype.loadDynamicAttributes = function (html) {
        var attributes = html.match(/<!--\s*attributes?="(.+)"/);
        if (attributes !== null)
            attributes = attributes[1].split(",").map(function (a) { return a.trim(); });
        else
            attributes = [];
        var Registry = ho.components.registry.instance;
        var promises = attributes
            .filter(function (attr) {
            return !Registry.hasAttribute(attr);
        })
            .map(function (attr) {
            return Registry.loadAttribute(attr);
        });
        return ho.promise.Promise.all(promises);
    };
    return View;
})(ho.components.Component);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvVmlldy92aWV3LnRzIl0sIm5hbWVzIjpbIlZpZXciLCJWaWV3LmNvbnN0cnVjdG9yIiwiVmlldy5pbml0IiwiVmlldy52aWV3bmFtZSIsIlZpZXcuc3RhdGVfY2hhbmdlZCIsIlZpZXcuZ2V0SHRtbCIsIlZpZXcubG9hZER5bmFtaWNSZXF1aXJlbWVudHMiLCJWaWV3LmxvYWREeW5hbWljQ29tcG9uZW50cyIsIlZpZXcubG9hZER5bmFtaWNBdHRyaWJ1dGVzIl0sIm1hcHBpbmdzIjoiQUFBQSxpRkFBaUY7QUFDakYsdUZBQXVGO0FBQ3ZGLDJFQUEyRTs7Ozs7OztBQUUzRTtJQUFtQkEsd0JBQXVCQTtJQUExQ0E7UUFBbUJDLDhCQUF1QkE7UUFFekNBLFNBQUlBLEdBQUdBLEVBQUVBLENBQUNBO1FBRVZBLGVBQVVBLEdBQUdBO1lBQ1pBLEVBQUVBLElBQUlBLEVBQUVBLFVBQVVBLEVBQUVBLFFBQVFBLEVBQUVBLElBQUlBLEVBQUVBO1NBQ3BDQSxDQUFDQTtJQW9HSEEsQ0FBQ0E7SUFsR0FELG1CQUFJQSxHQUFKQTtRQUNDRSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtJQUN2RUEsQ0FBQ0E7SUFFREYsc0JBQUlBLDBCQUFRQTthQUFaQTtZQUNDRyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtRQUNwQ0EsQ0FBQ0E7OztPQUFBSDtJQUVTQSw0QkFBYUEsR0FBdkJBLFVBQXdCQSxJQUF5QkE7UUFBakRJLGlCQW9CQ0E7UUFuQkdBLElBQUlBLElBQUlBLEdBQVdBLElBQUlBLENBQUNBO1FBQzNCQSxJQUFJQSxDQUFDQTtZQUNKQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxL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IDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uLy4uLy4uL2Jvd2VyX2NvbXBvbmVudHMvaG8tcHJvbWlzZS9kaXN0L3Byb21pc2UuZC50c1wiLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi8uLi8uLi9ib3dlcl9jb21wb25lbnRzL2hvLWNvbXBvbmVudHMvZGlzdC9jb21wb25lbnRzLmQudHNcIi8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vLi4vLi4vYm93ZXJfY29tcG9uZW50cy9oby1mbHV4L2Rpc3QvZmx1eC5kLnRzXCIvPlxuXG5jbGFzcyBWaWV3IGV4dGVuZHMgaG8uY29tcG9uZW50cy5Db21wb25lbnQge1xuXG5cdGh0bWwgPSBcIlwiO1xuXG5cdHByb3BlcnRpZXMgPSBbXG5cdFx0eyBuYW1lOiAndmlld25hbWUnLCByZXF1aXJlZDogdHJ1ZSB9XG5cdF07XG5cblx0aW5pdCgpIHtcblx0XHRoby5mbHV4LlNUT1JFUy5nZXQoaG8uZmx1eC5Sb3V0ZXIpLnJlZ2lzdGVyKHRoaXMuc3RhdGVfY2hhbmdlZCwgdGhpcyk7XG5cdH1cblxuXHRnZXQgdmlld25hbWUoKSB7XG5cdFx0cmV0dXJuIHRoaXMucHJvcGVydGllc1sndmlld25hbWUnXTtcblx0fVxuXG5cdHByb3RlY3RlZCBzdGF0ZV9jaGFuZ2VkKGRhdGE6IGhvLmZsdXguSVJvdXRlckRhdGEpOiB2b2lkIHtcblx0ICAgIGxldCBodG1sOiBzdHJpbmcgPSBudWxsO1xuXHRcdHRyeSB7XG5cdFx0XHRodG1sID0gZGF0YS5zdGF0ZS52aWV3LmZpbHRlcigodikgPT4ge1xuXHQgICAgICBcdFx0cmV0dXJuIHYubmFtZSA9PT0gdGhpcy52aWV3bmFtZTtcblx0XHQgICAgfSlbMF0uaHRtbDtcblx0XHR9IGNhdGNoKGUpIHtcblx0XHRcdGh0bWwgPSBudWxsO1xuXHRcdH1cblxuXHQgICAgdGhpcy5nZXRIdG1sKGh0bWwpXG4gIFx0XHQudGhlbihmdW5jdGlvbihoKSB7XG5cdCAgICAgIFx0aHRtbCA9IGg7XG5cdCAgICAgIFx0cmV0dXJuIHRoaXMubG9hZER5bmFtaWNSZXF1aXJlbWVudHMoaHRtbCk7XG5cdCAgICB9LmJpbmQodGhpcykpXG4gICAgICBcdC50aGVuKGZ1bmN0aW9uKCkge1xuXHQgICAgICBcdHRoaXMuaHRtbCA9IGZhbHNlO1xuXHQgICAgICBcdHRoaXMuZWxlbWVudC5pbm5lckhUTUwgPSBodG1sO1xuXHQgICAgICBcdHRoaXMucmVuZGVyKCk7XG5cdCAgICB9LmJpbmQodGhpcykpO1xuXHR9XG5cblx0XHRwcm90ZWN0ZWQgZ2V0SHRtbChodG1sOiBzdHJpbmcpOiBoby5wcm9taXNlLlByb21pc2U8c3RyaW5nLCBzdHJpbmc+IHtcblx0XHRpZiAodHlwZW9mIGh0bWwgPT09ICd1bmRlZmluZWQnKVxuXHQgICAgICBcdHJldHVybiBoby5wcm9taXNlLlByb21pc2UuY3JlYXRlKG51bGwpO1xuXHQgICAgZWxzZSBpZiAoaHRtbC5zbGljZSgtNSkgIT09ICcuaHRtbCcpXG5cdCAgICAgIFx0cmV0dXJuIGhvLnByb21pc2UuUHJvbWlzZS5jcmVhdGUoaHRtbCk7XG5cdCAgICBlbHNlIHJldHVybiBuZXcgaG8ucHJvbWlzZS5Qcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuXHQgICAgICBcdGxldCB4bWxodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cdCAgICAgIFx0eG1saHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcblx0ICAgICAgICBcdGlmICh4bWxodHRwLnJlYWR5U3RhdGUgPT0gNCkge1xuXHRcdCAgICAgICAgICBcdHZhciByZXNwID0geG1saHR0cC5yZXNwb25zZVRleHQ7XG5cdFx0ICAgICAgICAgIFx0aWYgKHhtbGh0dHAuc3RhdHVzID09IDIwMCkge1xuXHRcdCAgICAgICAgICAgIFx0cmVzb2x2ZShyZXNwKTtcblx0XHQgICAgICAgICAgXHR9IGVsc2Uge1xuXHRcdCAgICAgICAgICAgIFx0cmVqZWN0KHJlc3ApO1xuXHRcdCAgICAgICAgICBcdH1cblx0ICAgICAgICBcdH1cblx0ICAgICAgXHR9O1xuXG5cdCAgICAgIFx0eG1saHR0cC5vcGVuKCdHRVQnLCBodG1sLCB0cnVlKTtcblx0ICAgICAgXHR4bWxodHRwLnNlbmQoKTtcblxuXHRcdH0pO1xuXHR9XG5cblx0cHJvdGVjdGVkIGxvYWREeW5hbWljUmVxdWlyZW1lbnRzKGh0bWw6IHN0cmluZyk6IGhvLnByb21pc2UuUHJvbWlzZTxhbnksIGFueT4ge1xuXHRcdHJldHVybiBoby5wcm9taXNlLlByb21pc2UuYWxsKFt0aGlzLmxvYWREeW5hbWljQ29tcG9uZW50cyhodG1sKSwgdGhpcy5sb2FkRHluYW1pY0F0dHJpYnV0ZXMoaHRtbCldKTtcblx0fVxuXG5cdHByb3RlY3RlZCBsb2FkRHluYW1pY0NvbXBvbmVudHMoaHRtbDogc3RyaW5nKTogaG8ucHJvbWlzZS5Qcm9taXNlPHN0cmluZywgc3RyaW5nPiB7XG5cdCAgICBsZXQgcmVxdWlyZW1lbnRzID0gaHRtbC5tYXRjaCgvPCEtLVxccypyZXF1aXJlcz89XCIoLispXCIvKTtcblx0ICAgIGlmIChyZXF1aXJlbWVudHMgIT09IG51bGwpXG5cdCAgICAgIFx0cmVxdWlyZW1lbnRzID0gcmVxdWlyZW1lbnRzWzFdLnNwbGl0KFwiLFwiKS5tYXAoKHIpID0+IHsgcmV0dXJuIHIudHJpbSgpIH0pO1xuXHQgICAgZWxzZVxuXHQgICAgICBcdHJlcXVpcmVtZW50cyA9IFtdO1xuXG5cdCAgICBsZXQgUmVnaXN0cnkgPSBoby5jb21wb25lbnRzLnJlZ2lzdHJ5Lmluc3RhbmNlO1xuXG5cdCAgICBsZXQgcHJvbWlzZXMgPSByZXF1aXJlbWVudHNcbiAgICAgIFx0LmZpbHRlcigocmVxKSA9PiB7XG5cdCAgICAgIFx0cmV0dXJuICFSZWdpc3RyeS5oYXNDb21wb25lbnQocmVxKTtcblx0ICAgIH0pXG5cdCAgICAubWFwKChyZXEpID0+IHtcblx0ICAgIFx0cmV0dXJuIFJlZ2lzdHJ5LmxvYWRDb21wb25lbnQocmVxKTtcblx0ICAgIH0pO1xuXG5cdCAgICByZXR1cm4gaG8ucHJvbWlzZS5Qcm9taXNlLmFsbChwcm9taXNlcyk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgbG9hZER5bmFtaWNBdHRyaWJ1dGVzKGh0bWw6IHN0cmluZyk6IGhvLnByb21pc2UuUHJvbWlzZTxzdHJpbmcsIHN0cmluZz4ge1xuXHQgICAgbGV0IGF0dHJpYnV0ZXMgPSBodG1sLm1hdGNoKC88IS0tXFxzKmF0dHJpYnV0ZXM/PVwiKC4rKVwiLyk7XG5cdCAgICBpZiAoYXR0cmlidXRlcyAhPT0gbnVsbClcblx0ICAgICAgXHRhdHRyaWJ1dGVzID0gYXR0cmlidXRlc1sxXS5zcGxpdChcIixcIikubWFwKChhKSA9PiB7IHJldHVybiBhLnRyaW0oKSB9KTtcblx0ICAgIGVsc2Vcblx0ICAgICAgXHRhdHRyaWJ1dGVzID0gW107XG5cblx0ICAgIGxldCBSZWdpc3RyeSA9IGhvLmNvbXBvbmVudHMucmVnaXN0cnkuaW5zdGFuY2U7XG5cblx0ICAgIGxldCBwcm9taXNlcyA9IGF0dHJpYnV0ZXNcbiAgICAgIFx0LmZpbHRlcigoYXR0cikgPT4ge1xuXHQgICAgICBcdHJldHVybiAhUmVnaXN0cnkuaGFzQXR0cmlidXRlKGF0dHIpO1xuXHQgICAgfSlcblx0ICAgIC5tYXAoKGF0dHIpID0+IHtcblx0ICAgIFx0cmV0dXJuIFJlZ2lzdHJ5LmxvYWRBdHRyaWJ1dGUoYXR0cik7XG5cdCAgICB9KTtcblxuXHQgICAgcmV0dXJuIGhvLnByb21pc2UuUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuXHR9XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=