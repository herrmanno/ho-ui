var ho;!function(t){var e;!function(t){var e=function(){function t(t){this.data=void 0,this.onResolve=void 0,this.onReject=void 0,this.resolved=!1,this.rejected=!1,this.done=!1,this.ret=void 0,"function"==typeof t&&t.call(arguments.callee,function(t){this.resolve(t)}.bind(this),function(t){this.reject(t)}.bind(this))}return t.prototype.set=function(t){if(this.done)throw"Promise is already resolved / rejected";this.data=t},t.prototype.resolve=function(t){this.set(t),this.resolved=this.done=!0,"function"==typeof this.onResolve&&this._resolve()},t.prototype._resolve=function(){void 0===this.ret&&(this.ret=new t);var e=this.onResolve(this.data);e&&e instanceof t?e.then(this.ret.resolve.bind(this.ret),this.ret.reject.bind(this.ret)):this.ret.resolve(e)},t.prototype.reject=function(t){this.set(t),this.rejected=this.done=!0,"function"==typeof this.onReject&&this.onReject(this.data),this.ret&&this.ret.reject(this.data)},t.prototype._reject=function(){void 0===this.ret&&(this.ret=new t),"function"==typeof this.onReject&&this.onReject(this.data),this.ret.reject(this.data)},t.prototype.then=function(e,n){return void 0===this.ret&&(this.ret=new t),e&&"function"==typeof e&&(this.onResolve=e),n&&"function"==typeof n&&(this.onReject=n),this.resolved&&this._resolve(),this.rejected&&this._reject(),this.ret},t.prototype["catch"]=function(t){this.onReject=t,this.rejected&&this._reject()},t.all=function(e){var n=new t,o=[];return 0===e.length?n.resolve():e.forEach(function(t,r){t.then(function(t){if(!n.done){o[r]=t;var i=e.reduce(function(t,e){return t&&e.resolved},!0);i&&n.resolve(o)}})["catch"](function(t){n.reject(t)})}),n},t.chain=function(e){function n(){if(!o.done){var t=e.length?e.shift():o;t.then(function(t){r.push(t),n()},function(t){o.reject(t)})}}var o=new t,r=[];return n(),o},t.create=function(e){if(e instanceof t)return e;var n=new t;return n.resolve(e),n},t}();t.Promise=e}(e=t.promise||(t.promise={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){var e;!function(t){function e(t,e){return void 0===e&&(e=window),t.split(".").map(function(t){e=e[t]}),e}t.get=e}(e=t.util||(t.util={}))}(e=t.classloader||(t.classloader={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){var e;!function(t){function e(t,e){var n=t.split(".");t=n.pop();var o=window;if(n.map(function(t){o[t]=o[t]||{},o=o[t]}),o[t])throw"Global object "+n.join(".")+"."+t+" already exists";o[t]=e}t.expose=e}(e=t.util||(t.util={}))}(e=t.classloader||(t.classloader={}))}(ho||(ho={}));var ho;!function(t){var e;!function(e){var n;!function(e){function n(e){return new t.promise.Promise(function(t,n){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState){var e=o.responseText;200==o.status?t(e):n(e)}},o.open("GET",e),o.send()})}e.get=n}(n=e.xhr||(e.xhr={}))}(e=t.classloader||(t.classloader={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){var e=function(){function t(t,e){this.name=t.name,this.url=t.url||e(t.name),this.parent=t.parent||!0,this.expose=t.expose||!0,this["super"]=t["super"]}return t}();t.LoadArguments=e}(e=t.classloader||(t.classloader={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){var e=function(){function e(e){void 0===e&&(e={}),this.loadType=e.loadType||t.LoadType.EVAL,this.urlTemplate=e.urlTemplate||"${name}.js",this.useDir="boolean"==typeof e.useDir?e.useDir:!0,this.useMin="boolean"==typeof e.useMin?e.useMin:!1,this.cache="boolean"==typeof e.cache?e.cache:!0}return e}();t.LoaderConfig=e}(e=t.classloader||(t.classloader={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){!function(t){t[t.SCRIPT=0]="SCRIPT",t[t.FUNCTION=1]="FUNCTION",t[t.EVAL=2]="EVAL"}(t.LoadType||(t.LoadType={})),t.LoadType}(e=t.classloader||(t.classloader={}))}(ho||(ho={}));var ho;!function(ho){var classloader;!function(classloader){classloader.mapping={};var ClassLoader=function(){function ClassLoader(t){this.conf={},this.cache={},this.conf=new classloader.LoaderConfig(t)}return ClassLoader.prototype.config=function(t){this.conf=new classloader.LoaderConfig(t)},ClassLoader.prototype.load=function(t){switch(t=new classloader.LoadArguments(t,this.resolveUrl.bind(this)),this.conf.loadType){case classloader.LoadType.SCRIPT:return this.load_script(t);case classloader.LoadType.FUNCTION:return this.load_function(t);case classloader.LoadType.EVAL:return this.load_eval(t)}},ClassLoader.prototype.load_script=function(t){function e(){var e=this;return new ho.promise.Promise(function(n,o){var r=t.url,i=document.createElement("script");i.onload=function(){"function"==typeof classloader.util.get(t.name)?n([classloader.util.get(t.name)]):o("Error while loading Class "+t.name)}.bind(e),i.src=r,document.getElementsByTagName("head")[0].appendChild(i)})}var n=this,o=[],r=new ho.promise.Promise;return this.conf.cache&&this.cache[t.name]?ho.promise.Promise.create([this.cache[t.name]]):(t.parent?this.getParentName(t.url).then(function(e){return-1!==t["super"].indexOf(e)?[]:n.load({name:e,parent:!0,expose:t.expose,"super":t["super"]})}).then(function(t){return o=t,e()}).then(function(e){n.conf.cache&&(n.cache[t.name]=e),o=o.concat(e),r.resolve(o)}):e().then(function(t){r.resolve(t)}),r)},ClassLoader.prototype.load_function=function(t){var e,n=this,o=[];return classloader.xhr.get(t.url).then(function(o){if(e=o,t.parent){var r=n.parseParentFromSource(o);return-1!==t["super"].indexOf(r)?[]:n.load({name:r,parent:!0,expose:t.expose,"super":t["super"]})}}).then(function(n){o=n;var r=e+"\nreturn "+t.name+"\n//#sourceURL="+window.location.href+t.url,i=new Function(r)();return t.expose&&classloader.util.expose(t.name,i),i}).then(function(e){return n.conf.cache&&(n.cache[t.name]=e),o.push(e),o})},ClassLoader.prototype.load_eval=function(arg){var self=this,parents=[],source;return classloader.xhr.get(arg.url).then(function(t){if(source=t,arg.parent){var e=self.parseParentFromSource(t);return-1!==arg["super"].indexOf(e)?[]:self.load({name:e,parent:!0,expose:arg.expose,"super":arg["super"]})}}).then(function(p){parents=p;var ret="\n(function(){return "+arg.name+";})();",src=source+ret+"\n//#sourceURL="+window.location.href+arg.url,clazz=eval(src);return arg.expose&&classloader.util.expose(arg.name,clazz),clazz}).then(function(t){return self.conf.cache&&(self.cache[arg.name]=t),parents.push(t),parents})},ClassLoader.prototype.getParentName=function(t){var e=this;return classloader.xhr.get(t).then(function(t){return e.parseParentFromSource(t)})},ClassLoader.prototype.parseParentFromSource=function(t){var e=/}\)\((.*)\);/,n=t.match(e);return n?n[1]:void 0},ClassLoader.prototype.resolveUrl=function(t){return classloader.mapping[t]?classloader.mapping[t]:(this.conf.useDir&&(t+="."+t.split(".").pop()),t=t.split(".").join("/"),this.conf.useMin&&(t+=".min"),this.conf.urlTemplate.replace("${name}",t))},ClassLoader.prototype.exists=function(t){return!!this.cache[t]},ClassLoader}();classloader.ClassLoader=ClassLoader}(classloader=ho.classloader||(ho.classloader={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){function e(t){o.config(t)}function n(t){return o.load(t)}var o=new t.ClassLoader;t.config=e,t.load=n}(e=t.classloader||(t.classloader={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){function e(t,e,o){new n(t,e,o)}t.watch=e;var n=function(){function t(t,e,n){var o=this;this.obj=t,this.name=e,this.handler=n,this.oldVal=this.copy(t[e]),this.watch(function(n){o.oldVal!==t[e]&&(o.handler.call(null,t,e,o.oldVal,t[e],n),o.oldVal=o.copy(t[e]))})}return t.prototype.watch=function(t){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},n=function(o){t(o),e(n)};e(n)},t.prototype.copy=function(t){return JSON.parse(JSON.stringify(t))},t}()}(e=t.watch||(t.watch={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){var e;!function(t){function e(t){return r++,i[r]=t,r}function n(t){return i[t]}function o(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];i[t].apply(i,e)}var r=-1,i=[];t.set=e,t.get=n,t.call=o}(e=t.temp||(t.temp={}))}(e=t.components||(t.components={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.applyStyle=function(t,e){var n=this;void 0===e&&(e=t.style);var o=this.parseStyle(t.style);o.forEach(function(e){n.applyStyleBlock(t,e)})},t.prototype.applyStyleBlock=function(t,e){var n=this;"this"===e.selector.trim().toLowerCase()?e.rules.forEach(function(e){n.applyRule(t.element,e)}):Array.prototype.forEach.call(t.element.querySelectorAll(e.selector),function(t){e.rules.forEach(function(e){n.applyRule(t,e)})})},t.prototype.applyRule=function(t,e){var n=e.property.replace(/-(\w)/g,function(t,e){return e.toUpperCase()}).trim();t.style[n]=e.value},t.prototype.parseStyle=function(t){var e=/(.+?)\s*{(.*?)}/gm,n=/(.+?)\s?:(.+?);/gm;t=t.replace(/\n/g,"");var o=(t.match(e)||[]).map(function(t){if(!t.match(e))return null;var o=e.exec(t),r=(o[0],o[1]),i=o[2],s=(i.match(n)||[]).map(function(t){if(!t.match(n))return null;var e=n.exec(t),o=(e[0],e[1]),r=e[2];return{property:o,value:r}}).filter(function(t){return null!==t});return{selector:r,rules:s}}).filter(function(t){return null!==t});return o},t}();t.instance=new e}(e=t.styler||(t.styler={}))}(e=t.components||(t.components={}))}(ho||(ho={}));var ho;!function(t){var e;!function(e){var n;!function(e){var n=function(){function t(){this.children=[]}return t}(),o=function(){function e(){this.r={tag:/<([^>]*?(?:(?:('|")[^'"]*?\2)[^>]*?)*)>/,repeat:/repeat=["|'].+["|']/,type:/[\s|/]*(.*?)[\s|\/|>]/,text:/(?:.|[\r\n])*?[^"'\\]</m},this.voids=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],this.cache={}}return e.prototype.render=function(t){if("boolean"!=typeof t.html||t.html){var e=t.name,n=this.cache[e]=this.cache[e]||this.parse(t.html).root;n=this.renderRepeat(this.copyNode(n),t);var o=this.domToString(n,-1);t.element.innerHTML=o}},e.prototype.parse=function(e,o){void 0===o&&(o=new n);for(var r;null!==(r=this.r.tag.exec(e));){var i,s,a,c,u,h,p;if(0!==r.index?(i=e.match(this.r.text)[0],i=i.substr(0,i.length-1),s="TEXT",c=!1,u=!0,h=!1):(i=r[1].trim(),s=(i+">").match(this.r.type)[1],a="/"===i[0],c=this.isVoid(s),u=c||"/"===i[i.length-1],h=!!i.match(this.r.repeat),u&&t.components.registry.instance.hasComponent(s)&&(u=!1,i=i.substr(0,i.length-1)+" ",p=!0)),e=e.slice(i.length+("TEXT"===s?0:2)),a)break;if(o.children.push({parent:o,html:i,type:s,isVoid:c,selfClosing:u,repeat:h,children:[]}),!p&&!u){var l=this.parse(e,o.children[o.children.length-1]);e=l.html,o.children.pop(),o.children.push(l.root)}r=e.match(this.r.tag)}return{root:o,html:e}},e.prototype.renderRepeat=function(t,e){e=[].concat(e);for(var n=0;n<t.children.length;n++){var o=t.children[n];if(o.repeat){var r,i=/repeat=["|']\s*(\S+)\s+as\s+(\S+?)["|']/,s=o.html.match(i).slice(1),a=s[1];if(a.indexOf(",")>-1){var c=a.split(",");a=c[0].trim(),r=c[1].trim()}var u=this.evaluate(e,s[0]),h=[];u.forEach(function(t,n){var i={};i[a]=t,i[r]=n;var s=[].concat(e);s.unshift(i);var c=this.copyNode(o);c.repeat=!1,c.html=c.html.replace(this.r.repeat,""),c.html=this.repl(c.html,s),c=this.renderRepeat(c,s),h.push(c)}.bind(this)),h.forEach(function(e){t.children.splice(t.children.indexOf(o),0,e)}),t.children.splice(t.children.indexOf(o),1)}else o.html=this.repl(o.html,e),o=this.renderRepeat(o,e),t.children[n]=o}return t},e.prototype.domToString=function(t,e){e=e||0;var n="",o="	";return t.html&&(n+=new Array(e).join(o),"TEXT"!==t.type?t.selfClosing&&!t.isVoid?(n+="<"+t.html.substr(0,--t.html.length)+">",n+="</"+t.type+">\n"):n+="<"+t.html+">":n+=t.html),n&&(n+="\n"),t.children.length&&(n+=t.children.map(function(n){return this.domToString(n,e+(t.type?1:2))}.bind(this)).join("\n")),t.type&&"TEXT"!==t.type&&!t.selfClosing&&(n+=new Array(e).join(o),n+="</"+t.type+">\n"),n},e.prototype.repl=function(t,e){var n=/{(.+?)}}?/g,o=t.match(n);if(!o)return t;for(;o.length;){var r=o[0];r=r.substr(1,r.length-2);var i=this.evaluate(e,r);void 0!==i&&("function"==typeof i&&(i="ho.components.Component.getComponent(this)."+r),t=t.replace(o[0],i)),o=o.slice(1)}return t},e.prototype.evaluate=function(t,e){return"{"===e[0]&&"}"===e[--e.length]?this.evaluateExpression(t,e.substr(1,e.length-2)):"#"===e[0]?this.evaluateFunction(t,e.substr(1)):this.evaluateValue(t,e)},e.prototype.evaluateValue=function(t,e){return this.evaluateValueAndModel(t,e).value},e.prototype.evaluateValueAndModel=function(t,e){-1==t.indexOf(window)&&t.push(window);for(var n=0,o=void 0;n<t.length&&void 0===o;){o=t[n];try{o=new Function("model","return model['"+e.split(".").join("']['")+"']")(o)}catch(r){o=void 0}finally{n++}}return{value:o,model:t[--n]}},e.prototype.evaluateExpression=function(t,e){-1==t.indexOf(window)&&t.push(window);for(var n=0,o=void 0;n<t.length&&void 0===o;){o=t[n];try{o=new Function(Object.keys(o).toString(),"return "+e).apply(null,Object.keys(o).map(function(t){return o[t]}))}catch(r){o=void 0}finally{n++}}return o},e.prototype.evaluateFunction=function(e,n){var o=this.evaluateExpression.bind(this,e),r=n.split("("),i=r[0],s=r[1];s=s.substr(0,--s.length);var a=this.evaluateValueAndModel(e,i),c=a.value,u=a.model,h=c,p=s.split(".").map(function(t){return 0===t.indexOf("#")?t.substr(1):o(t)});h=h.bind.apply(h,[u].concat(p));var l=t.components.temp.set(h),f="ho.components.temp.call("+l+")";return f},e.prototype.copyNode=function(t){var e=this.copyNode.bind(this),n={parent:t.parent,html:t.html,type:t.type,selfClosing:t.selfClosing,repeat:t.repeat,children:t.children.map(e)};return n},e.prototype.isVoid=function(t){return-1!==this.voids.indexOf(t.toLowerCase())},e}();e.Renderer=o,e.instance=new o}(n=e.renderer||(e.renderer={}))}(e=t.components||(t.components={}))}(ho||(ho={}));var ho;!function(t){var e;!function(e){var n;!function(e){var n=t.promise.Promise,o=function(){function e(){this.cache={}}return e.prototype.resolve=function(e){return t.components.registry.useDir&&(e+="."+e.split(".").pop()),e=e.split(".").join("/"),"components/"+e+".html"},e.prototype.getHTML=function(t){var e=this;return new n(function(n,o){if("string"==typeof e.cache[t])return n(e.cache[t]);var r=e.resolve(t),i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState){var e=i.responseText;200==i.status?n(e):o("Error while loading html for Component "+t)}},i.open("GET",r,!0),i.send()})},e}();e.HtmlProvider=o,e.instance=new o}(n=e.htmlprovider||(e.htmlprovider={}))}(e=t.components||(t.components={}))}(ho||(ho={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);n.prototype=e.prototype,t.prototype=new n},ho;!function(t){var e;!function(e){var n=function(){function t(t,n){this.element=t,this.component=e.Component.getComponent(t),this.value=n,this.init()}return t.prototype.init=function(){},Object.defineProperty(t.prototype,"name",{get:function(){return t.getName(this)},enumerable:!0,configurable:!0}),t.prototype.update=function(){},t.getName=function(e){return e instanceof t?e.constructor.toString().match(/\w+/g)[1]:e.toString().match(/\w+/g)[1]},t}();e.Attribute=n;var o=function(e){function n(t,n){e.call(this,t,n),this.r=/#(.+?)#/g;var o=this.value.match(this.r)||[];o.map(function(t){t=t.substr(1,t.length-2),this.watch(t)}.bind(this)),this.value=this.value.replace(/#/g,"")}return __extends(n,e),n.prototype.watch=function(e){var n=e.split("."),o=n.pop(),r=this.component;n.map(function(t){r=r[t]}),t.watch.watch(r,o,this.update.bind(this))},n.prototype.eval=function(t){var e=this.component;return e=new Function(Object.keys(e).toString(),"return "+t).apply(null,Object.keys(e).map(function(t){return e[t]}))},n}(n);e.WatchAttribute=o}(e=t.components||(t.components={}))}(ho||(ho={}));var ho;!function(t){var e;!function(e){var n=t.promise.Promise,o=t.components.htmlprovider.instance,r=t.components.renderer.instance,i=function(){function i(t){this.html="",this.style="",this.properties=[],this.attributes=[],this.requires=[],this.children={},this.element=t,this.element.component=this,this.original_innerHTML=t.innerHTML}return Object.defineProperty(i.prototype,"name",{get:function(){return i.getName(this)},enumerable:!0,configurable:!0}),i.prototype.getName=function(){return this.name},i.prototype.getParent=function(){return i.getComponent(this.element.parentNode)},i.prototype._init=function(){var t=this.render.bind(this);this.initProperties();var e=[this.initHTML(),n.create(this.init()),this.loadRequirements()],o=new n;return n.all(e).then(function(){o.resolve(),t()})["catch"](function(t){throw o.reject(t),t}),o},i.prototype.init=function(){},i.prototype.update=function(){return void 0},i.prototype.render=function(){r.render(this),t.components.registry.instance.initElement(this.element).then(function(){this.initChildren(),this.initStyle(),this.initAttributes(),this.update()}.bind(this))},i.prototype.initStyle=function(){"undefined"!=typeof this.style&&null!==this.style&&("string"!=typeof this.style||0!==this.style.length)&&e.styler.instance.applyStyle(this)},i.prototype.initHTML=function(){var t=new n,e=this;return"undefined"==typeof this.html?(this.html="",t.resolve()):-1!==this.html.indexOf(".html",this.html.length-".html".length)?o.getHTML(this.name).then(function(n){e.html=n,t.resolve()})["catch"](t.reject):t.resolve(),t},i.prototype.initProperties=function(){this.properties.forEach(function(t){if("object"==typeof t){if(this.properties[t.name]=this.element[t.name]||this.element.getAttribute(t.name)||t["default"],void 0===this.properties[t.name]&&t.required===!0)throw"Property "+t.name+" is required but not provided"}else"string"==typeof t&&(this.properties[t]=this.element[t]||this.element.getAttribute(t))}.bind(this))},i.prototype.initChildren=function(){for(var t=this.element.querySelectorAll("*"),e=0;e<t.length;e++){var n=t[e];n.id&&(this.children[n.id]=n),n.tagName&&(this.children[n.tagName]=this.children[n.tagName]||[]),this.children[n.tagName].push(n)}},i.prototype.initAttributes=function(){var e=this;this.attributes.forEach(function(n){var o=t.components.registry.instance.getAttribute(n);Array.prototype.forEach.call(e.element.querySelectorAll("*["+n+"]"),function(t){var e=t.hasOwnProperty(n)?t[n]:t.getAttribute(n);"string"==typeof e&&""===e&&(e=void 0),new o(t,e).update()})})},i.prototype.loadRequirements=function(){var e=this.requires.filter(function(e){return!t.components.registry.instance.hasComponent(e)}).map(function(e){return t.components.registry.instance.loadComponent(e)}),o=this.attributes.filter(function(e){return!t.components.registry.instance.hasAttribute(e)}).map(function(e){return t.components.registry.instance.loadAttribute(e)}),r=e.concat(o);return n.all(r)},i.getComponent=function(t){for(;!t.component;)t=t.parentNode;return t.component},i.getName=function(t){return t instanceof i?t.constructor.toString().match(/\w+/g)[1]:t.toString().match(/\w+/g)[1]},i}();e.Component=i}(e=t.components||(t.components={}))}(ho||(ho={}));var ho;!function(t){var e;!function(e){var n;!function(n){var o=t.promise.Promise;n.mapping={},n.useDir=!0;var r=function(){function r(){this.components=[],this.attributes=[],this.componentLoader=new t.classloader.ClassLoader({urlTemplate:"components/${name}.js",useDir:n.useDir}),this.attributeLoader=new t.classloader.ClassLoader({urlTemplate:"attributes/${name}.js",useDir:n.useDir})}return r.prototype.register=function(t){t.prototype instanceof e.Component?(this.components.push(t),document.createElement(e.Component.getName(t))):t.prototype instanceof e.Attribute&&this.attributes.push(t)},r.prototype.run=function(){var t=this.initComponent.bind(this),e=this.components.map(function(e){return t(e)});return o.all(e)},r.prototype.initComponent=function(t,n){void 0===n&&(n=document);var r=Array.prototype.map.call(n.querySelectorAll(e.Component.getName(t)),function(e){return new t(e)._init()});return o.all(r)},r.prototype.initElement=function(t){var e=this.initComponent.bind(this),n=Array.prototype.map.call(this.components,function(n){return e(n,t)});return o.all(n)},r.prototype.hasComponent=function(t){return this.components.filter(function(n){return e.Component.getName(n)===t}).length>0},r.prototype.hasAttribute=function(t){return this.attributes.filter(function(n){return e.Attribute.getName(n)===t}).length>0},r.prototype.getAttribute=function(t){return this.attributes.filter(function(n){return e.Attribute.getName(n)===t})[0]},r.prototype.loadComponent=function(t){var e=this;return this.componentLoader.load({name:t,url:n.mapping[t],"super":["ho.components.Component"]}).then(function(t){return t.map(function(t){e.register(t)}),t.pop()})},r.prototype.loadAttribute=function(t){var e=this;return this.attributeLoader.load({name:t,url:n.mapping[t],"super":["ho.components.Attribute","ho.components.WatchAttribute"]}).then(function(t){return t.map(function(t){e.register(t)}),t.pop()})},r}();n.Registry=r,n.instance=new r}(n=e.registry||(e.registry={}))}(e=t.components||(t.components={}))}(ho||(ho={}));var ho;!function(t){var e;!function(e){function n(){return t.components.registry.instance.run()}function o(e){t.components.registry.instance.register(e)}e.run=n,e.register=o}(e=t.components||(t.components={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){var e=function(){function t(){this.prefix="ID_",this.lastID=1,this.callbacks={}}return t.prototype.register=function(t,e){var n=this.prefix+this.lastID++;return this.callbacks[n]=e?t.bind(e):t,n},t.prototype.unregister=function(t){if(!this.callbacks[t])throw"Could not unregister callback for id "+t;delete this.callbacks[t]},t}();t.CallbackHolder=e}(e=t.flux||(t.flux={}))}(ho||(ho={}));var ho;!function(t){var e;!function(e){var n;!function(e){var n=t.promise.Promise;e.mapping={},e.useDir=!0;var o=function(){function o(){this.stores={},this.storeLoader=new t.classloader.ClassLoader({urlTemplate:"stores/${name}.js",useDir:e.useDir})}return o.prototype.register=function(t){return this.stores[t.name]=t,t},o.prototype.get=function(t){var e=void 0;return e="string"==typeof t?t:t.toString().match(/\w+/g)[1],this.stores[e]},o.prototype.loadStore=function(t){var o=this;return this.stores[t]?n.create(this.stores[t]):this.storeLoader.load({name:t,url:e.mapping[t],"super":["ho.flux.Store"]}).then(function(t){return t.map(function(t){o.register(new t).init()}),o.get(t.pop())})},o}();e.Registry=o}(n=e.registry||(e.registry={}))}(e=t.flux||(t.flux={}))}(ho||(ho={}));var ho;!function(t){var e;!function(e){var n;!function(e){var n=t.promise.Promise,o=function(){function t(){this.useMin=!1}return t.prototype.resolve=function(){return this.useMin?"states.min.js":"states.js"},t.prototype.getStates=function(t){var e=this;return void 0===t&&(t="States"),new n(function(n,o){var r=e.resolve(),i=document.createElement("script");i.onload=function(){n(new window[t])},i.onerror=function(t){o(t)},i.src=r,document.getElementsByTagName("head")[0].appendChild(i)})},t}();e.instance=new o}(n=e.stateprovider||(e.stateprovider={}))}(e=t.flux||(t.flux={}))}(ho||(ho={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);n.prototype=e.prototype,t.prototype=new n},ho;!function(t){var e;!function(e){var n=function(e){function n(){e.call(this),this.handlers={},this.id=t.flux.DISPATCHER.register(this.handle.bind(this)),t.flux.STORES.register(this)}return __extends(n,e),n.prototype.init=function(){},Object.defineProperty(n.prototype,"name",{get:function(){return this.constructor.toString().match(/\w+/g)[1]},enumerable:!0,configurable:!0}),n.prototype.register=function(t,n){return e.prototype.register.call(this,t,n)},n.prototype.on=function(t,e){this.handlers[t]=e},n.prototype.handle=function(t){"function"==typeof this.handlers[t.type]&&this.handlers[t.type](t.data)},n.prototype.changed=function(){for(var t in this.callbacks){var e=this.callbacks[t];e&&e(this.data)}},n}(e.CallbackHolder);e.Store=n}(e=t.flux||(t.flux={}))}(ho||(ho={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);n.prototype=e.prototype,t.prototype=new n},ho;!function(t){var e;!function(e){var n=t.promise.Promise,o=function(o){function r(){o.apply(this,arguments),this.mapping=null}return __extends(r,o),r.prototype.init=function(){this.on("STATE",this.onStateChangeRequested.bind(this));var t=this.onHashChange.bind(this);return this.initStates().then(function(){window.onhashchange=t,t()})},r.prototype.go=function(e,n){var o={state:void 0,args:void 0,extern:!1};"string"==typeof e?(o.state=e,o.args=n):(o.state=e.state,o.args=e.args),t.flux.DISPATCHER.dispatch({type:"STATE",data:o})},r.prototype.initStates=function(){return e.stateprovider.instance.getStates().then(function(t){this.mapping=t.states}.bind(this))},r.prototype.getStateFromName=function(t){return this.mapping.filter(function(e){return e.name===t})[0]},r.prototype.onStateChangeRequested=function(t){var e=this.getStateFromName(t.state),o=this.urlFromState(e.url,t.args);if(!(this.data&&this.data.state&&this.data.state.name===t.state&&this.equals(this.data.args,t.args)&&o===window.location.hash.substr(1))){e.redirect&&(e=this.getStateFromName(e.redirect));var r="function"==typeof e.before?e.before(t):n.create(void 0);r.then(function(){var n=!!t.extern;this.data={state:e,args:t.args,extern:n};var o=this.urlFromState(e.url,t.args);this.setUrl(o),this.changed()}.bind(this),function(t){this.onStateChangeRequested(t)}.bind(this))}},r.prototype.onHashChange=function(){var e=this.stateFromUrl(window.location.hash.substr(1));t.flux.DISPATCHER.dispatch({type:"STATE",data:{state:e.state,args:e.args,extern:!0}})},r.prototype.setUrl=function(t){if(window.location.hash.substr(1)!==t){var e=window.onhashchange;window.onhashchange=null,window.location.hash=t,window.onhashchange=e}},r.prototype.regexFromUrl=function(t){for(var e=/:([\w]+)/;t.match(e);)t=t.replace(e,"([^/]+)");return t+"$"},r.prototype.argsFromUrl=function(t,e){var n=this.regexFromUrl(t),o=t.match(n).slice(1),r=e.match(n).slice(1),i={};return o.forEach(function(t,e){i[t.substr(1)]=r[e]}),i},r.prototype.stateFromUrl=function(t){var e=this,n=void 0;if(this.mapping.forEach(function(o){if(!n){var r=e.regexFromUrl(o.url);if(t.match(r)){var i=e.argsFromUrl(o.url,t);n={state:o.name,args:i,extern:!1}}}}),!n)throw"No State found for url "+t;return n},r.prototype.urlFromState=function(t,e){for(var n=/:([\w]+)/;t.match(n);)t=t.replace(n,function(t){return e[t.substr(1)]});return t},r.prototype.equals=function(t,e){return JSON.stringify(t)===JSON.stringify(e)},r}(e.Store);e.Router=o}(e=t.flux||(t.flux={}))}(ho||(ho={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);n.prototype=e.prototype,t.prototype=new n},ho;!function(t){var e;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.isPending={},this.isHandled={},this.isDispatching=!1,this.pendingPayload=null}return __extends(e,t),e.prototype.waitFor=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(!this.isDispatching)throw"Dispatcher.waitFor(...): Must be invoked while dispatching.";for(var n=0;n<t.length;n++){var o=t[n];if(this.isPending[o]){if(!this.isHandled[o])throw"waitFor(...): Circular dependency detected while wating for "+o}else{if(!this.callbacks[o])throw"waitFor(...): "+o+" does not map to a registered callback.";this.invokeCallback(o)}}},e.prototype.dispatch=function(t){if(this.isDispatching)throw"Cannot dispatch in the middle of a dispatch.";this.startDispatching(t);try{for(var e in this.callbacks)this.isPending[e]||this.invokeCallback(e)}finally{this.stopDispatching()}},e.prototype.invokeCallback=function(t){this.isPending[t]=!0,this.callbacks[t](this.pendingPayload),this.isHandled[t]=!0},e.prototype.startDispatching=function(t){for(var e in this.callbacks)this.isPending[e]=!1,this.isHandled[e]=!1;this.pendingPayload=t,this.isDispatching=!0},e.prototype.stopDispatching=function(){this.pendingPayload=null,this.isDispatching=!1},e}(t.CallbackHolder);t.Dispatcher=e}(e=t.flux||(t.flux={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){function e(){return t.STORES.get(t.Router).init()}t.DISPATCHER=new t.Dispatcher,t.STORES=new t.registry.Registry,t.dir=!1,t.run=e}(e=t.flux||(t.flux={}))}(ho||(ho={}));var ho;!function(t){var e;!function(e){function n(e){void 0===e&&(e=new s),e=new s(e);var n=e.process().then(t.components.run).then(t.flux.run);return n}e.run=n;var o=["Stored","View"],r=["Bind","BindBi"],i=[],s=function(){function e(e){void 0===e&&(e={}),this.root="App",this.router=t.flux.Router,this.map=!0,this.mapDefault="bower_components/ho-ui/dist/",this.dir=!0,this.min=!1;for(var n in e)this[n]=e[n]}return e.prototype.process=function(){return t.promise.Promise.create(this.processDir()).then(this.processMin.bind(this)).then(this.processMap.bind(this)).then(this.processRouter.bind(this)).then(this.processRoot.bind(this))},e.prototype.processRoot=function(){var e=this;return new t.promise.Promise(function(n,o){"string"==typeof e.root?t.components.registry.instance.loadComponent(e.root).then(n)["catch"](o):(t.components.registry.instance.register(e.root),n(null))})},e.prototype.processRouter=function(){var e=this;return new t.promise.Promise(function(n,o){"string"==typeof e.router?t.flux.STORES.loadStore(e.router).then(n)["catch"](o):n(new e.router)})},e.prototype.processMap=function(){var e=this;if("boolean"==typeof this.map){if(!this.map)return;this.map=this.mapDefault}o.forEach(function(n){t.components.registry.mapping[n]=e.map+"components/"+n+"/"+n+".js"}),r.forEach(function(n){t.components.registry.mapping[n]=e.map+"attributes/"+n+"/"+n+".js"}),i.forEach(function(n){t.flux.registry.mapping[n]=e.map+"stores/"+n+"/"+n+".js"})},e.prototype.processDir=function(){t.components.dir=this.dir},e.prototype.processMin=function(){},e}()}(e=t.ui||(t.ui={}))}(ho||(ho={}));